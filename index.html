<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="fit3179_a2.css">
    <title>FIT3179 Data Visualization 2</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <h1 class="centered_title">Climate Change Statistics</h1>
  <!-- Container for the visualization -->
  <div class="centered_container">
    <div id="choropleth_map" class="centered_div">
      <script>
        const vis1 = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "title": "Global Annual Surface Temperatures",
          "width": 800,
          "height": 400,
          "params": [
            {
              "name": "Year_selection",
              "value": 2022,
              "bind": {
                "input": "range",
                "min": 1990,
                "max": 2022,
                "step": 1,
                "name": "Year:  "
              }
            }
          ],
          "projection": {"type": "equalEarth"},
          "layer": [
            {
              "data": {
                "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
                "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
              },
              "transform": [
                {
                  "calculate": "'Data is not available in ' + datum.properties.NAME",
                  "as": "note"
                }
              ],
              "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"},
              "encoding": {"tooltip": {"field": "note"}}
            },
            {
              "data": {
                "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
                "format": {"type": "topojson", "feature": "oceans"}
              },
              "mark": {"type": "geoshape", "fill": "skyblue"}
            },
            {
              "data": {
                "url": "https://raw.githubusercontent.com/stak0015/climate-change-datasets/refs/heads/main/yearly-average-surface-temperature.csv"
              },
              "transform": [
                {
                  "lookup": "ISO_Code",
                  "from": {
                    "data": {
                      "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
                      "format": {
                        "type": "topojson", 
                        "feature": "ne_110m_admin_0_countries"
                        }
                    },
                  "key": "properties.ISO_A3"
                  },
                  "as": "geo"
                },
                {
                  "filter": "datum.Year == Year_selection"
                }
              ],
              "mark": {
                "type": "geoshape", 
                "stroke": "white"
              }, 
              "encoding": {
                "shape": {"field": "geo", "type": "geojson"},
                "color": {
                  "field": "Temperature",
                  "type": "quantitative",
                  "scale": {"domain": [-20, 30], "scheme": "redblue", "reverse": true},
                  "legend": {"format": ".2s"}
                },
                "tooltip": [
                  {"field": "Country", "type": "nominal", "title": "Country"},
                  {
                    "field": "Temperature",
                    "type": "quantitative",
                    "title": "Annual Surface Tempearture",
                    "format": ","
                  },
                  {"field": "Year", "type": "quantitative", "title": "Year"}
                ]
              }
            }
          ],
          "config": {}
        }; 
        vegaEmbed('#choropleth_map', vis1, {mode: "vega-lite"}).then(console.log).catch(console.warn);;
      </script>
    </div>
  </div>
    
  <br>

  <div class="centered_container">
    <div id="area_chart" class="centered_div">
      <script>
        const vis2 = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "data": {
            "url": "https://raw.githubusercontent.com/stak0015/climate-change-datasets/refs/heads/main/co-emissions-per-capita.csv"
          },
          "vconcat": [
            {
              "width": 750,
              "height": 375,
              "title": "Annual CO2 Emissions per capita by Region (t)",
              "mark": "area",
              "encoding": {
                "x": {
                  "field": "Year",
                  "type": "temporal",
                  "scale": {"domain": {"param": "brush"}},
                  "axis": {"title": "", "tickCount": 10}
                },
                "y": {
                  "aggregate": "sum", 
                  "field": "Annual-co2-emissions-per-capita",
                  "title": "CO2 Emissions per capita (t)"
                  },
                "color": {
                  "field": "Entity", "scale": {"scheme": "darkred"}
                },
                "tooltip": [
                  {
                    "field": "Entity", 
                    "type": "nominal", 
                    "title": "Region:"
                  },
                  {
                    "field": "Year", 
                    "type": "temporal", 
                    "title": "Year:",
                    "format": "%Y"
                  },
                  {
                    "field": "Annual-co2-emissions-per-capita", 
                    "type": "quantitative", 
                    "title": "CO2 Emissions (t):"
                  }
                ]
              }
            },
            {
              "width": 750,
              "height": 75,
              "title": "Click and drag to filter data based on interval",
              "mark": "area",
              "params": [
                {"name": "brush", "select": {"type": "interval", "encodings": ["x"]}}
              ],
              "encoding": {
                "x": {"field": "Year", "type": "temporal", "axis": {"tickCount": 10}},
                "y": {
                  "aggregate": "sum",
                  "field": "Annual-co2-emissions-per-capita",
                  "title": "Emissions"
                },
                "color": {
                  "field": "Entity", "scale": {"scheme": "blues"},
                  "legend": {
                    "title": "Region"
                  }
                }
              }
            }
          ]
        };
        vegaEmbed('#area_chart', vis2, {mode: "vega-lite"}).then(console.log).catch(console.warn);;
      </script>
    </div>
  </div>

  <br>

  <div class="centered_container">
    <div id="stacked_bar_chart" class="centered_div">
      <script>
        const vis3 = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/stak0015/climate-change-datasets/refs/heads/main/number-of-natural-disaster-events.csv"
  },
  "title": "Number of Natural Disaster Occurrences (1950-2024)",
  "width": 1000,
  "height": 500,
  "mark": {"type": "bar", "size": 12},
  "params": [
    {
      "name": "Selection",
      "value": "All",
      "bind": {
        "input": "select",
        "options": ["All", "Drought", "Dry mass movement", "Earthquake", "Extreme temperature", "Extreme weather", "Flood", "Glacial lake outburst flood", "Volcanic activity", "Wet mass movement", "Wildfire"],
        "name": "Disaster: "
      }
    }
  ],
  "transform": [
    {
      "filter": "datum.Year > 1949"
    },
    {
      "filter": "datum.Entity != 'Fog'"
    },
    {
      "filter": "Selection != 'All' ? datum.Entity == Selection : true"
    }
  ], 
  "encoding": {
    "x": {
      "field": "Year",
      "type": "ordinal",
      "title": "Year",
      "axis": {
        "labelExpr": "datum.label % 5 == 0 ? datum.label : ''"
      }
      
    },
    "y": {
      "aggregate": "sum",
      "field": "Disasters",
      "type": "quantitative",
      "title": "Number of Occurrences"
    },
    "color": {
      "field": "Entity",
      "type": "nominal",
      "legend": {"title": "Natural Disaster"}
    },
    "tooltip": [
      {"field": "Entity", "type": "nominal", "title": "Country: "},
      {"field": "Year", "type": "quantitative", "title": "Year: "},
      {"field": "Disasters", "type": "quantitative", "title": "Occurrences: "}
    ]
  }
};
        vegaEmbed('#stacked_bar_chart', vis3, {mode: "vega-lite"}).then(console.log).catch(console.warn);;
      </script>
    </div>
  </div>

<br>

  <div class="centered_container">
    <div id="line_chart" class="centered_div">
      <script>
        const vis4 = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Stock prices of 5 Tech Companies over Time.",
  "data": {"url": "https://raw.githubusercontent.com/stak0015/climate-change-datasets/refs/heads/main/ghg-emissions-by-sector.csv"},
  "title": "Annual Greenhouse Gas Emissions by Sector (1990-2020)",
  "width": 750,
  "height": 500,
  "layer": [
    {
      "mark": {
        "type": "line",
        "point": {
          "filled": false,
          "fill": "white"
        }
      }
    },
    {
      "transform": [
        {"filter": "datum.Year == 2020 && datum.Sector == 'Electricity-and-heat'"}
      ],
      "mark": {
        "type": "rect",
        "xOffset": -80,
        "yOffset": 68,
        "width": 170,
        "height": 90,
        "fill": "yellow",
        "fillOpacity": 0.2,
        "stroke": "black",
        "cornerRadius": 5
      },
      "encoding": {
        "text": {"field": "label"}
      }
    },
    {
      "transform": [
        {"filter": "datum.Year == 2020 && datum.Sector == 'Electricity-and-heat'"},
        {
          "calculate": "'Highest Sector'",
          "as": "label"
        },
      ],
      "mark": {
        "type": "text",
        "xOffset": -80,
        "yOffset": 45,
        "fontSize": 15,
        "lineBreak": "_",
        "lineHeight": 25,
        "fill": "black",
        "fontWeight": "bold"
        
      },
      "encoding": {
        "text": {"field": "label"}
      }
    },
    {
      "transform": [
        {"filter": "datum.Year == 2020 && datum.Sector == 'Electricity-and-heat'"},
        {
          "calculate": "'Electricity and heat'",
          "as": "label"
        },
      ],
      "mark": {
        "type": "text",
        "xOffset": -80,
        "yOffset": 70,
        "fontSize": 15,
        "lineBreak": "_",
        "lineHeight": 25,
        "fill": "black"
      },
      "encoding": {
        "text": {"field": "label"}
      }
    },
    {
      "transform": [
        {"filter": "datum.Year == 2020 && datum.Sector == 'Electricity-and-heat'"},
        {
          "calculate": "'(+75% between 1990-2020)'",
          "as": "label"
        },
      ],
      "mark": {
        "type": "text",
        "xOffset": -80,
        "yOffset": 90,
        "fontSize": 12,
        "lineBreak": "_",
        "lineHeight": 25,
        "fill": "red"
      },
      "encoding": {
        "text": {"field": "label"}
      }
    }
  ],
  "encoding": {
    "x": {"field": "Year", "type": "ordinal", "axis": {"labelExpr": "datum.label % 5 == 0 ? datum.label : ''"}},
    "y": {"field": "Emissions", "type": "quantitative", "title": "Greenhouse Gas Emissions (t)"},
    "color": {"field": "Sector", "type": "nominal"},
    "tooltip": [
      {"field": "Sector", "type": "nominal", "title": "Sector: "},
      {"field": "Year", "type": "ordinal", "title": "Year: "},
      {"field": "Emissions", "type": "quantitative", "title": "Annual Emissions (t): ", "format": ","}
    ]
  }
};
        vegaEmbed('#line_chart', vis4, {mode: "vega-lite"}).then(console.log).catch(console.warn);;
      </script>
    </div>
  </div>

</body>
</html>
